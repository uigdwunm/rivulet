## 流程设计
+ 整体分为
  + 编译阶段
    + 这个阶段在项目启动时，一次性编译好所有sql语句。
  + 执行阶段
    + 这个阶段就是使用者每次调用想和持久层交互时，进行拼接参数、发送执行语句、映射结果
+ 重要组件
  + definer
    + 定义器，管理预定义的表元信息模型。
  + describer
    + 描述器，专门给调用者编写语句用的，设置了很多语法糖，方便调用者通过链式调用生成想要的语句。
  + parser
    + 解析器，将描述器生成的结果，解析成框架内部的语句存储单元，
  + convertor
    + 转换器，orm框架必备的产物，每个字段和数据库类型的对应。
    + 在这里你不必非常严格的定义字段的类型一定要和数据库类型一致，只要配置好转换器，可以转换成任何类型。
  + assigner
    + 赋值器，查询结果赋值到模型中。
    + 这里的结果模型可以和查询模型不一致，也不会固定的返回map，只要你指定了映射方案，可以映射成任何类型。
  + definition
    + 开发者定义的语句中的每个元素，都会解析成一个definition进行存储。
    + 而一个完成的语句由许多definition组成，被称为blueprint，是一个超级definition，这里记录了这个语句所有需要被记录的东西。
  + generator
    + 生成器，功能是在运行时将传入的参数和definition，拼接成语句。
  + pipeline
    + 管道，运行时通过它来调度一切，每次查询时：
      + 先将参数和definition传入管道，
      + 它会调用生成器生成语句，
      + 再找到相应的执行计划进行执行
      + 最终返回结果。
    + 另外它会调用沿途各种扩展点。
  + warehouse
    + 算是个杂物仓库，什么东西都往里放，这东西以后可能会推倒重来。
    + 我希望以后用它来对接spring之类的容器框架。

## 扩展点


## 模块分层说明
+ 目前有三个模块
  + rivulet-base
  + rivulet-sql
  + rivulet-mysql
+ 依赖关系从下到上。  
+ 每层包里只包含自己特色的内容，除了第一层base唯一，其余层未来都会扩展其他模块。  
  + 比如第三层目前只有mysql，以后可能会扩展对接其他的，如oracle、sqlserver之类的符合sql规范的持久层中间件。  
  + 第二层目前sql，以后可能会扩展mongo、elasticsearch等

## 愿景
从包分层上来看，很显然我希望统一持久层，所有存储类框架都用一种方式调用。

## 关于持久层
+ 我这里定义的持久层，可能不是广泛的定义
  + 是所有存储类的中间件，包括但不限于mysql、mongo、es之类的拥有存储能力的东西。
  + 通过拥有通过特定语法语句进行调用的能力。

## 主要能力
+ 基于上面对这类中间件功能的定义，使用流程一定可以归类成这些：
  + 拼语句
  + 发送到中间件，接受返回结果
  + 映射结果为模型、map、list之类的
+ 至于其他的一些能力，会保留很多扩展点进行支持，比如事物、连接管理等
+ 不同中间件调用时，最重要的差异性就是不同的语句语法，所以我的框架最主要也是最强的能力，就是拼语句。

## 没有缓存
+ mybatis是有缓存的，但是我这里没有。
+ 在单机的时代，缓存是会有非常大的优势，但是现在都是集群，感觉缓存已经有点鸡肋了。
+ 目前没考虑，但是我留下了足够的扩展点，相加也能加。

## 设计演进
+ 第一阶段
  + 一开始我只是在开发过程中使用了mybatis，觉得每次写语句都比较麻烦，还总是写错。
  + 觉得hibernate那种映射很方便，但是联表查询又很麻烦。
  + 于是想要自己设计一种方式把他们结合起来。
+ 第二阶段
  + 当我在设计我设想中的框架时，第一点想到的，也是最重要的定位就是方便拼语句。
  + 性能方面，语句必须预先编译好，易于拼接参数，拼好语句后，其余的由连接池操心。
  + mybatis-plus
    + 当我开始设计调研时，在github上随便查了一下，看到了mybatis-plus
    + 其实它有一部分可以满足我的需要了,但是我逐步发现mybatis-plus还是支持的不够，拼语句的能力局限较大。
    + 并且mybatis-plus只是mybatis的一个插件，有一定的局限性。
    + 当然，说了这么多，主要还是觉得我的设计更好。
+ 第三阶段
  + 当我把拼语句作为框架的主要定位时，有一天我突然想到，查sql是拼语句，查mongo也是拼语句，查es也是拼语句。
  + 那完全可以把他们统一起来，所以变成了现在的模块分包。
+ 第四阶段
  + sql、mongo、es这些存储类的中间件，有一些通用的查询能力，比如：
    + equal字段
    + in字段
    + \>
    + <
    + like
    + ……
  + 这种简单的单表查询，以及单表的增删改，是绝大部分的使用场景。
  + 那么完全可以在base层用统一的格式来屏蔽掉这种检查查询的底层语句。
    + 对使用者来说可以用同一种格式，查询sql、mongo、es。
  + 实际上随着现在微服务的流行，表越拆越细、简单的单表查询已经成为常态。

## 半成品
+ 这个框架经过几番改进、推倒重头再来，又因为我的拖延症，历经了一年多快两年，终于成为一个半成品。
+ 我是以mysql的语法支持来实现第一个版本的，后来发现想要相对完整的支持sql，真的太难了。sql的联表查询、子查询嵌套、别名、各种类型，还有函数都太变态了。
+ 好在现在已经解决了这些，目前的半成品已经初步可以展示出我的框架的强大之处。